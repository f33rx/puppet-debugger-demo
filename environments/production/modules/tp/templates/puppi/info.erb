#!/bin/bash
# Script generated by Puppet. It's executed when you run:
# puppi info <%= @title %> 
#
# Sources common header for Puppi scripts
. <%= scope.lookupvar('::puppi::params::scriptsdir') %>/header || exit 10

<% if @settings['package_name'] and @settings['package_name'] != "" -%>
# Show packages info
echo_title "$HOSTNAME - <%= @title %>: Packages Installed: <% @array_package_name.each do |item| %><%= item %><% end %>"
<% @array_package_name.each do |item| -%>
show_command "<%= scope.lookupvar('::puppi::params::info_package_query') %> <%= item %>"
<% if @verbose == true -%>
show_command "<%= scope.lookupvar('::puppi::params::info_package_list') %> <%= item %>"
<% else -%>
show_command "<%= scope.lookupvar('::puppi::params::info_package_list') %> <%= item %> | egrep '(/bin|^/etc|/sbin|log$)'"
<% end -%>
<% end -%>
<% end -%>

<% if @settings['config_file_path'] and @settings['config_file_path'] != "" -%>
# Show config info
echo_title "$HOSTNAME - <%= @title %>: Configuration File: <%= @settings['config_file_path'] %>"
<% if @verbose == true -%>
show_command "cat <%= @settings['config_file_path'] %>"
<% else -%> 
show_command "head <%= @settings['config_file_path'] %>"
<% end -%>
<% end -%>

<% if @settings['data_dir_path'] and @settings['data_dir_path'] != "" -%>
# Show data dir
echo_title "$HOSTNAME - <%= @title %>: Application data are in: <%= @settings['data_dir_path'] %>"
show_command "ls -latr <%= @settings['data_dir_path'] %>"
show_command "df <%= @settings['data_dir_path'] %>"
<% end -%>

<% if @settings['log_dir_path'] and @settings['log_dir_path'] != "" -%>
# Show log dir
echo_title "$HOSTNAME - <%= @title %>: Logs are in: <%= @settings['log_dir_path'] %>"
show_command "ls -latr <%= @settings['log_dir_path'] %>"
<% end -%>

<% if @settings['log_file_path'] and @settings['log_file_path'] != "" -%>
# Show logs
echo_title "$HOSTNAME - <%= @title %>: Last log entries: <% @array_log_file_path.each do |item| %><%= item %><% end %>"
<% @array_log_file_path.each do |item| -%>
<% if @verbose == true -%>
show_command "tail -30 <%= item %>"
<% else -%>
show_command "tail -10 <%= item %>"
<% end -%>
<% end -%>
<% end -%>

<% if @settings['service_name'] and @settings['service_name'] != "" -%>
# Show service info
echo_title "$HOSTNAME - <%= @title %>: Services: <% @array_service_name.each do |item| %><%= item %><% end %>"
<% @array_service_name.each do |item| -%>
show_command "/etc/init.d/<%= item %> status"
<% if @verbose == "yes" -%>
show_command "ps -adef | grep <%= @item %> | grep -v grep"
<% else -%>
show_command "ps -adef | grep <%= @item %> | grep -v grep | head -20"
<% end -%>
<% end -%>
<% end -%>

<% if @settings['tcp_port'] and @settings['tcp_port'] != "" -%>
# Show ports info
echo_title "$HOSTNAME - <%= @title %>: TCP ports: <% @array_tcp_port.each do |item| %><%= item %><% end %>"
<% @array_tcp_port.each do |mport| -%>
<% if @verbose == "yes" -%>
show_command "netstat -natup | grep ':<%= mport %> '"
<% else -%>
show_command "netstat -natup | grep ':<%= mport %> ' | head -20"
<% end -%>
<% end -%>
<% end -%>

<% if @settings['info_commands'] and @settings['info_commands'] != '' -%>
echo_title "$HOSTNAME - <%= @title %>: Info Commands"
<% @array_info_commands.split.each do |cmd| %>show_command "<%= cmd %>"
<% end -%>
<% end -%>


